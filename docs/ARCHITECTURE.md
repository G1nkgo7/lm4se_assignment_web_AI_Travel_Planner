# 架构概览

## 系统组成

- **前端 (Next.js)**：提供行程创建、地图展示、费用仪表盘、语音交互等 UI，负责调用后端 API 与 Supabase 服务。
- **后端 (Node.js)**：封装大模型、地图、语音与预算分析逻辑，统一处理鉴权、速率限制与审计日志。
- **数据层 (Supabase/Firebase)**：处理用户认证、行程数据、费用记录、偏好设置及文件存储。
- **第三方服务**：
  - 语音识别与合成：科大讯飞或阿里云语音服务。
  - 地图导航：高德地图、百度地图或其他同类服务。
  - 大语言模型：OpenAI、阿里云百炼、DeepSeek 等可替换模型。

## 前后端通信

- RESTful API + SSE/WebSocket：用于行程生成、费用记录、实时协同等场景。
- Webhook/任务队列：处理长耗时的行程优化、行程 PDF 生成等后台任务。

## 数据流示例

1. 用户通过语音输入旅行需求，前端调用语音识别 API 获取文本。
2. 前端向后端发送行程生成请求，后端构造 Prompt 调用大模型，结合地图与检索结果生成行程计划。
3. 行程计划存入 Supabase，并通过 Realtime 通知其他登录设备同步更新。
4. 用户在旅行中通过语音记账，后端记录费用并实时更新预算差异图表。

## 安全策略

- 所有外部 API Key 通过后端代理和 `.env` 管理，前端仅使用临时 token。
- Supabase 启用行级安全 (RLS) 保证用户隔离。
- 对外暴露的 API 采用速率限制、IP 白名单与审计日志。

## 部署拓扑

- 本地开发：Docker Compose 启动前后端服务，推荐直接使用云端 Supabase。
- CI/CD：GitHub Actions 构建前后端镜像，推送至阿里云镜像仓库。
- 生产部署：
  - 前端托管于 Vercel/阿里云 Web 服务。
  - 后端运行在容器平台（阿里云 ACK/Serverless Kubernetes）。
  - 通过 API 网关统一接入，启用 HTTPS 与 WAF。
